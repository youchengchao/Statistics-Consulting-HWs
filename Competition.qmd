---
title: "取消文化之現象分析"
date: today
author: 高嘉妤、柯堯珹、吳承恩、趙友誠
format:
 pdf:
    fig-pos: 'h'
    engine: xelatex
    include-in-header:
      - text: |
         \usepackage{setspace,relsize}
         \usepackage{geometry}
         \usepackage{xeCJK}
         \usepackage{float}
         \geometry{verbose,tmargin=2.5cm,bmargin=2.5cm,lmargin=2.5cm,rmargin=2.5cm}
         \setmainfont{Times New Roman}
         \setCJKmainfont{標楷體}
toc: true
documentclass: article
---

| Variables | Explanation          | remark             |
|-----------|----------------------|--------------------|
| q1        | 性別                 | 1:男性, 2:女性     |
| q2|年齡|1:18\~29歲, 2:30\~39歲, 3:40\~49歲,\newline 4:50\~59歲, 5:60\~69歲, 6:70歲(含)以上|
| q3        | 出生縣市    | 1\~19是台灣的縣市(資料沒有連江、澎湖、金門), 24是其他   |
| q4        | 教育程度    | 1:高中及以下, 2:專科, 3:大學, 4:研究所         |
| q5        | 週上網天數           |                    |
| q6        | 上網時數(工作、學習) |                    |
| q7        | 上網時數(娛樂、休閒) |                    |
| q8        | 上網原因             |                    |
| q9        | 使用的即時通訊軟體   |                    |
| q10       | 使用的社群媒體       |                    |
| q11       | 使用的影音平台       |                    |
| q12       | 了解疫情消息的管道   |                    |
| q13_01    | 使用網路平台關注疫情消息的頻率|           |
| q13_02    | 疫情相關留言的言論種類        |           |
| q13_03    | 疫情相關留言對自己的幫助      |           |
| q13_04    | 疫情相關留言的負面性質        |           |
| q13_05    | 疫情相關留言對自己的負面影響 |             |
| q14_01    | 社群媒體上的來源             |             |
| q14_02    | Line上的來源                 |             |
| q14_03    | YT上的來源                   |             |
| q15_01    | 疫情期間是否減少出門         |             |
| q15_02    | 減少出門時的休閒活動         |             |
| q15_03    | 政府疫情處置的滿意度         |             |
| q16       | 是否參與過不會對人造成傷害的網路惡搞 |     |
| q17_01    | 是騙人的不會對人造成傷害的網路惡搞   |     |
| q17_02    | 不是騙人的不會對人造成傷害的網路惡搞 |     |
| q18       | 是否參與過會對人造成傷害的網路惡搞   |     |
| q19_01    | 是騙人的會對人造成傷害的網路惡搞     |     |
| q19_02    | 不是騙人的會對人造成傷害的網路惡搞 |       |
| q20       | 主動激化傾向                       |       |
| q21_a     | 注意力偵測| 專心:只選第六項並填寫已讀二字\newline 分心:其他情況 |
| q22       | 他人攻擊傾向|                              |
| q23       | 自己攻擊傾向|                              |
| q24       | 回聲室效應 |                               |
| q25       | 被攻擊的接受度 |                           |
| q26       | 推測他人攻擊意圖 |                          |
| q27       | 抵制意圖    |                               |
| q28       | 採取過的社群媒體抵制行為種類  |             |
| q29       | 抵制的原因   |                              |
| q30       | 抵制行為的有效程度  |                      |
| q31       | 抵制前的同理心   |                          |
| q32       | 抵制行為的對名人的傷害程度 |                |
| q33       | 抵制行為的對自己的重要程度 |                |
| q34       | 抵制成本        |                            |
| q35       | 抵制規模感知    |                            |
| q36       | 抵制的社會壓力  |                            |
| q37_a     | 注意力偵測     |   專心:彩虹有七個顏色\newline 分心: otherwise |
| q38_01    | 生活滿意度    |                              |
| q38_02    | 社會滿意度   |                               |
| q39       | 生活品質    |                                |
| q40       | 國民黨喜好程度   |                           |
| q41       | 民進黨喜好程度   |                           |
| q42       | 意識形態         | 0\~10: 台獨\~統一         |

: 變數解釋

```{r}
#| output: FALSE
#| warning: FALSE
library(haven)           #read sav file
library(labelled)      #remove attribute of sav data
library(Hmisc)         #describe
library(showtext)      #show zw-tw in ggplot2
library(dplyr);library(ggplot2);library(MASS)
library(rlang)         #for building function
#DB.sav <-read_sav("DisruptiveBehavior.sav")
#write.csv(DB.sav,file= "DisruptiveBehavior.csv", row.names= FALSE)
DB.csv <-read.csv("DisruptiveBehavior.csv")
showtext_auto()
```

```{r}
DB.csv <- DB.csv[,-c(1:4)]
#DataExplorer::plot_missing(DB.csv[,1:20])
```

```{r}
#| output: asis
#latex(describe(DB.csv),title="",file="")
```

```{r}
#第二題(出生年)改成年齡的區段
DB.csv$q2 <- DB.csv$rrq2
DB.csv$rrq2 <- NULL

#把第三題(出生地)的其他類別歸為一類
DB.csv$q3_other <- NULL

#第四題沒有人選其他
DB.csv$q4_88_text <- NULL

#教育程度重新劃分為四個等級
DB.csv$q4[DB.csv$q4<=8] <- 1
DB.csv$q4[DB.csv$q4!=1 & DB.csv$q4<=15] <- 2
DB.csv$q4[DB.csv$q4>2 & DB.csv$q4<=19] <- 3
DB.csv$q4[DB.csv$q4>3] <- 4

#時間統一單位(分)
DB.csv$q6 <- DB.csv$q6_h*60+DB.csv$q6_m
DB.csv$q7 <- DB.csv$q7_h*60+DB.csv$q7_m
DB.csv$q6_h <- NULL; DB.csv$q6_m <- NULL
DB.csv$q7_h <- NULL; DB.csv$q7_m <- NULL

#第八題沒有人選其他
DB.csv$q8_88 <- NULL
DB.csv$q8_88_text <- NULL
DB.csv$q8_90 <- NULL

#第九題簡化(使用哪些通訊軟體 改成 使用幾個通訊軟體)
DB.csv$q9 <- rowSums(
  DB.csv[,match("q9_1",colnames(DB.csv)):match("q9_8",colnames(DB.csv))],
  na.rm = TRUE) +
  sapply(DB.csv[,"q9_88_text"], function(entry_i){
    temp <- gsub(" ","",entry_i)
    return(length(unlist(strsplit(temp,",|及"))))
  })
DB.csv[,match("q9_1",colnames(DB.csv)):match("q9_90",colnames(DB.csv))] <- NULL

#移除第十、十一題
DB.csv[,match("q10_1",colnames(DB.csv)):match("q10_90",colnames(DB.csv))] <- NULL
DB.csv[,match("q11_1",colnames(DB.csv)):match("q11_90",colnames(DB.csv))] <- NULL

#移除疫情相關的問題(12題到15題)
DB.csv[,match("q12_1", colnames(DB.csv)):match("q15_03_1", colnames(DB.csv))] <- NULL

#移除注意力偵測題
DB.csv[,match("q21a_1", colnames(DB.csv)):match("q21a_6_text", colnames(DB.csv))] <- NULL
DB.csv$q37a <- NULL
DB.csv$rq21a <- NULL
DB.csv$rq37a <- NULL
DB.csv$r <- NULL
DB.csv$qrq2 <- NULL
```


```{r}
#有無抵制行為(1:有,0:沒有)
DB.csv$q28_5[DB.csv$q28_5==1] <- 0
DB.csv$q28_5[is.na(DB.csv$q28_5)] <- 1

#歸類28題的選項
DB.csv[DB.csv$q28_4_text=="會破壞我對他（她）的形象",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q28_4_text=="從來都不關注",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q28_4_text=="若名人不自我反省就會抵制，但是通常名人都會願意出來面對錯誤",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q28_4_text=="未來此人所說的話均會產生疑問",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q28_4_text=="用選票來抵制",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q28_4_text=="很多時候都是立場不同、換位思考一下後，就可以消弭一些爭議。",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q28_4_text=="看看就好",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q28_4_text=="拒買相關商品",c('q28_4','q28_4_text')] <- c(NA,"")

DB.csv[DB.csv$q28_4_text=="沒意見",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q28_4_text=="看看就好,自己會有自己的判斷",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q28_4_text=="與親朋好友說明事實真相",
                  c('q28_4','q28_4_text')] <- c(NA,"")
DB.csv[DB.csv$q28_4_text=="要看是什麼原因決定一時間這麼做還是永久",
                  c('q28_4','q28_4_text')] <- c(NA,"")

DB.csv[DB.csv$q28_4_text=="指正他的錯誤",
                  c('q28_4','q28_4_text')] <- c(NA,"")
DB.csv[
  DB.csv$q28_4_text=="每個人有合法的言論自由，我只會拒絕觀看有問題違法的影片，不會ㄧ竿子打翻ㄧ條船。",
  c('q28_2','q28_4','q28_4_text')] <- c(1,NA,"")
DB.csv[
  DB.csv$q28_4_text=="減少看他們的發文或影片",
  c('q28_2','q28_4','q28_4_text')] <- c(1,NA,"")
DB.csv[
  DB.csv$q28_4_text=="轉發相關的指正或譴責文章",
  c('q28_4','q28_4_text')] <- c(NA,"")
#歸類29題的選項
#29的第五選項改定義為 錯誤資訊、不當言論
DB.csv$q29_5_text[DB.csv$q29_5_text=="錯誤資訊"] <- ""

DB.csv[DB.csv$q29_5_text=="道不同不相為謀不理他們",
       c('q29_2','q29_5','q29_5_text')] <- c(1,NA,"")

DB.csv[DB.csv$q29_5_text=="沒有此情況",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv$q29_5_text[DB.csv$q29_5_text=="發表錯誤資訊且不更改"] <- ""

DB.csv[DB.csv$q29_5_text=="不會抵制",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q29_5_text=="我沒有特別抵制過呢",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q29_5_text=="從來沒有",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q29_5_text=="不明白指的是什麼",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q29_5_text=="過於私人或主觀意識的回答會讓我反感進而抵制收看",
       c('q29_2','q29_5','q29_5_text')] <- c(1,NA,"")

DB.csv[DB.csv$q29_5_text=="已讀",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv$q29_5_text[DB.csv$q29_5_text=="縵罵"] <- ""

DB.csv[DB.csv$q29_5_text=="不理他們",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv$q29_5_text[DB.csv$q29_5_text=="指鹿為馬，不實言論，刻意誤導輿論方向。"] <- ""
DB.csv$q29_5_text[DB.csv$q29_5_text=="不當發言"] <- ""
DB.csv$q29_5_text[
  DB.csv$q29_5_text=="假名人之姿發表利己損害公眾利益的言論，企圖影響他人判斷的言論者。"] <- ""

DB.csv$q29_5_text[DB.csv$q29_5_text=="散播不正確消息且不認錯"] <- ""
DB.csv[DB.csv$q29_5_text=="不予置評",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q29_5_text=="無",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q29_5_text=="不會做無聊的事情",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q29_5_text=="目前沒有",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q29_5_text=="味全黑心油事件",
       c('q29_5','q29_5_text')] <- c(NA,"")

DB.csv$q29_5_text[
  DB.csv$q29_5_text=="對動物議題留下錯誤言論，對疫情走向發出錯誤言論（去年康健發文說嬰幼兒不會染疫，被我指正，卻不改言論，"] <- ""

DB.csv[DB.csv$q29_5_text=="不曾",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q29_5_text=="沒遇過要抵制的事",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[
  DB.csv$q29_5_text=="說謊話（至少是我覺得他在說謊），做錯事不負責還甩鍋給別人。",
  c('q29_5','q29_5_text')] <- c(NA,"")

#有兩個 沒有
DB.csv[match("沒有",DB.csv$q29_5_text),
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[match("沒有",DB.csv$q29_5_text),
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv[DB.csv$q29_5_text=="有些事情的看法 做法不同",
       c('q29_2','q29_5','q29_5_text')] <- c(1,NA,"")

DB.csv[DB.csv$q29_5_text=="違反當初自己宣揚的理念",
       c('q29_4','q29_5','q29_5_text')] <- c(1,NA,"")

DB.csv[
  DB.csv$q29_5_text=="泛指公眾人物沒有責任表態但有義務不支持通稱反人類行為，私領域不要太誇張都沒差",
  c('q29_4','q29_5','q29_5_text')] <- c(1,NA,"")

DB.csv[DB.csv$q29_5_text=="沒有抵制過",
       match("q28_1", colnames(DB.csv)):match("q36_1", colnames(DB.csv))] <- c(rep(NA,4),"",0,rep(NA,5),"",rep(NA,7))

DB.csv$q29_5_text[DB.csv$q29_5_text=="誤導"] <- ""
DB.csv$q29_5_text <- NULL
DB.csv$q28_4_text <- NULL
```


```{r}
DB.csv$q16 <- NULL
DB.csv$q18 <- NULL
DB.csv$q17_01[is.na(DB.csv$q17_01)|DB.csv$q17_01==2] <- 0
DB.csv$q17_02[is.na(DB.csv$q17_02)|DB.csv$q17_02==2] <- 0

DB.csv$q19_01[is.na(DB.csv$q19_01)|DB.csv$q19_01==2] <- 0
DB.csv$q19_02[is.na(DB.csv$q19_02)|DB.csv$q19_02==2] <- 0

# DB.csv$q22_total <- rowSums(DB.csv[,c("q22_01_1", "q22_02_1", "q22_03_1", "q22_04_1", "q22_05_1")])
# DB.csv$q23_total <- rowSums(DB.csv[,c("q23_01_1", "q23_02_1", "q23_03_1", "q23_04_1", "q23_05_1")])
# DB.csv$q24_total <- rowSums(DB.csv[,c("q24_01_1", "q24_02_1", "q24_03_1", "q24_04_1", "q24_05_1")])
# DB.csv$q25_total <- rowSums(DB.csv[,c("q25_01_1", "q25_02_1", "q25_03_1", "q25_04_1")])
# DB.csv$q26_total <- rowSums(DB.csv[,c("q26_01_1", "q26_02_1", "q26_03_1")])
# DB.csv$q38_total <- rowSums(DB.csv[,c("q38_01_1", "q38_02_1")])

DB.csv$q40_cat <- cut(DB.csv$q40_1, 
                        breaks = c(0, 20, 40, 60, 80, 100), 
                        labels = c(1, 2, 3, 4, 5), 
                        right = TRUE)
DB.csv$q40_cat[is.na(DB.csv$q40_cat)] <- 1
DB.csv$q41_cat <- cut(DB.csv$q41_1, 
                       breaks = c(0, 20, 40, 60, 80, 100), 
                       labels = c(1, 2, 3, 4, 5), 
                       right = TRUE)
DB.csv$q41_cat[is.na(DB.csv$q41_cat)] <- 1
```

```{r}
myCount_q28 <- function(din, target_label){
  din %>%
    group_by(q28_5, !!sym(target_label)) %>%
    summarise(count = sum(weight))
}
Barplot.p <- function(din){
  split_label<-colnames(din)[1]
  cat_label <- colnames(din)[2]
  c_label <- colnames(din)[3]
  temp <- din %>%
    group_by(!!sym(split_label)) %>%
    mutate(proportion = !!sym(c_label) / sum(!!sym(c_label))) %>%
    ungroup()
  ggplot(temp, aes(x = factor(!!sym(split_label)), y = proportion, fill = factor(!!sym(cat_label)))) +
    geom_bar(stat = "identity", position = "stack") +
    labs(x = "Proportion", y = "Percentage") +
    scale_fill_grey(start = 0.1, end = 0.9) +
    ggtitle(label = cat_label)+
    theme_minimal() +
    coord_flip()
}
```

```{r}
#| eval: false
counts_16_18 <- DB.csv %>%
  group_by(q28_5, q16_18) %>%
  summarise(count = sum(weight))
#圖
ggplot(counts_16_18, aes(x = as.factor(q28_5), y = q16_18, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_16_18$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs網路惡搞", x = "boycott", y = "網路惡搞行為", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))  # 旋轉 x 軸刻度標籤，以避免重疊
which(is.na(DB.csv$q16_18))

#為了讓討厭的人知道他不屬於您的團體，在網路上罵他，您覺得可不可以接受?計數
counts_20_01 <- DB.csv%>%
  group_by(q28_5,q20_01_1)%>%
  summarise(count = n())
#圖
ggplot(counts_20_01, aes(x = as.factor(q28_5), y = q20_01_1, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_20_01$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs不屬團體之網路罵人接受度", x = "boycott", y = "接受度", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))  # 旋轉 x 軸刻度標籤，以避免重疊
#為了獲得想要的，在網路上罵人，您覺得可不可以接受?計數
counts_20_02 <- DB.csv%>%
  group_by(q28_5,q20_02_1)%>%
  summarise(count = n())
ggplot(counts_20_02, aes(x = as.factor(q28_5), y = q20_02_1, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_20_02$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs獲得想要之網路罵人接受度", x = "boycott", y = "接受度", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))  # 旋轉 x 軸刻度標籤，以避免重疊

#網路世界看到別人的網路攻擊行為

counts_22 <- DB.csv%>%
  group_by(q28_5,q22_total)%>%
  summarise(count = n())
#圖
ggplot(counts_22, aes(x = as.factor(q28_5), y = q22_total, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_22$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs別人的網路攻擊行為", x = "boycott", y = "網路攻擊頻繁程度", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))  # 旋轉 x 軸刻度標籤，以避免重疊
#網路世界自己做出的網路攻擊行為

counts_23 <- DB.csv%>%
  group_by(q28_5,q23_total)%>%
  summarise(count = n())
#圖
ggplot(counts_23, aes(x = as.factor(q28_5), y = q23_total, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_23$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs自己的網路攻擊行為", x = "boycott", y = "網路攻擊頻繁程度", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))  # 旋轉 x 軸刻度標籤，以避免重疊
#越容易接收到不是使用者偏好的訊息

counts_24 <- DB.csv%>%
  group_by(q28_5,q24_total)%>%
  summarise(count = n())
#圖
ggplot(counts_24, aes(x = as.factor(q28_5), y = q24_total, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_24$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs接收不是使用者偏好的頻繁程度", x = "boycott", y = "頻繁程度", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))
#越能接受網路攻擊

counts_25 <- DB.csv%>%
  group_by(q28_5,q25_total)%>%
  summarise(count = n())
#圖
ggplot(counts_25, aes(x = as.factor(q28_5), y = q25_total, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_25$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs接受網路攻擊行為", x = "boycott", y = "接受網路攻擊", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))

#推測他人的攻擊意圖

counts_26 <- DB.csv%>%
  group_by(q28_5,q26_total)%>%
  summarise(count = n())
#圖
ggplot(counts_26, aes(x = as.factor(q28_5), y = q26_total, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_26$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs他人攻擊意圖頻繁程度", x = "boycott", y = "頻繁程度", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))

#當名人說不該說的話、做不該做的事，您多想透過社群媒體抵制他們？
counts_27 <- DB.csv%>%
  group_by(q28_5,q27_1)%>%
  summarise(count = n())
ggplot(counts_27, aes(x = as.factor(q28_5), y = q27_1, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_27$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs多想抵制他們的程度", x = "boycott", y = "抵制程度", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))
#心理幸福感

counts_38 <- DB.csv%>%
  group_by(q28_5,q38_total)%>%
  summarise(count = n())

ggplot(counts_38, aes(x = as.factor(q28_5), y = q38_total, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_38$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs生活與社會的滿意程度", x = "boycott", y = "生活與社會的滿意程度", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))
#您覺得目前的日子過得快不快樂？ 
counts_39 <- DB.csv%>%
  group_by(q28_5,q39_1)%>%
  summarise(count = n())
ggplot(counts_39, aes(x = as.factor(q28_5), y = q39_1, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_39$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs快樂程度", x = "boycott", y = "快樂程度", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))

#國民黨讓你感到溫暖的程度，再區分為5個範圍

counts_40 <- DB.csv%>%
  group_by(q28_5,q40_cat)%>%
  summarise(count = n())
ggplot(counts_40, aes(x = as.factor(q28_5), y = q40_cat, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_40$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs國民黨之溫暖", x = "boycott", y = "溫暖", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))


#民進黨讓你感到溫暖的程度，再區分為5個範圍

counts_41 <- DB.csv%>%
  group_by(q28_5,q41_cat)%>%
  summarise(count = n())

ggplot(counts_41, aes(x = as.factor(q28_5), y = q41_cat, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_41$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs民進黨之溫暖", x = "boycott", y = "溫暖", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))

#兩岸關係
counts_42 <- DB.csv%>%
  group_by(q28_5,q42_1)%>%
  summarise(count = n())

ggplot(counts_42, aes(x = as.factor(q28_5), y = q42_1, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  geom_text(label=counts_42$count,size = 3, color = "black", fontface = "bold")+
  labs(title = "抵制vs兩岸關係之偏頗", x = "boycott", y = "兩岸關係", fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))
```

```{r}
#| eval: false
Barplot.p(din=myCount_q28(DB.csv, "q16_18"))
Barplot.p(din=myCount_q28(DB.csv, "q20_01_1"))
Barplot.p(din=myCount_q28(DB.csv, "q20_02_1"))
Barplot.p(din=myCount_q28(DB.csv, "q22_total"))
Barplot.p(din=myCount_q28(DB.csv, "q23_total"))
Barplot.p(din=myCount_q28(DB.csv, "q24_total"))
Barplot.p(din=myCount_q28(DB.csv, "q25_total"))
Barplot.p(din=myCount_q28(DB.csv, "q26_total"))
Barplot.p(din=myCount_q28(DB.csv, "q27_1"))
Barplot.p(din=myCount_q28(DB.csv, "q38_total"))
Barplot.p(din=myCount_q28(DB.csv, "q39_1"))
Barplot.p(din=myCount_q28(DB.csv, "q40_cat"))
Barplot.p(din=myCount_q28(DB.csv, "q41_cat"))
Barplot.p(din=myCount_q28(DB.csv, "q42_1"))
```

```{r}
#| eval: false
ks.test(counts_16_18$count[counts_16_18$q28_5==1],
        counts_16_18$count[counts_16_18$q28_5==0])

ks.test(counts_20_01$count[counts_20_01$q28_5==1],
        counts_20_01$count[counts_20_01$q28_5==0])

ks.test(counts_20_02$count[counts_20_02$q28_5==1],
        counts_20_02$count[counts_20_02$q28_5==0])

ks.test(counts_22$count[counts_22$q28_5==1],
        counts_22$count[counts_22$q28_5==0])

ks.test(counts_23$count[counts_23$q28_5==1],
        counts_23$count[counts_23$q28_5==0])

ks.test(counts_24$count[counts_24$q28_5==1],
        counts_24$count[counts_24$q28_5==0])

ks.test(counts_25$count[counts_25$q28_5==1],
        counts_25$count[counts_25$q28_5==0])

ks.test(counts_26$count[counts_26$q28_5==1],
        counts_26$count[counts_26$q28_5==0])

ks.test(counts_27$count[counts_27$q28_5==1],
        counts_27$count[counts_27$q28_5==0])

ks.test(counts_38$count[counts_38$q28_5==1],
        counts_38$count[counts_38$q28_5==0])

ks.test(counts_39$count[counts_39$q28_5==1],
        counts_39$count[counts_39$q28_5==0])

ks.test(counts_40$count[counts_40$q28_5==1],
        counts_40$count[counts_40$q28_5==0])

ks.test(counts_41$count[counts_41$q28_5==1],
        counts_41$count[counts_41$q28_5==0])

ks.test(counts_42$count[counts_42$q28_5==1],
        counts_42$count[counts_42$q28_5==0])
```

# 嘗試PCA與決策樹

```{r}
#| eval: false
library(ggplot2)
library(dplyr)
library(showtext)
showtext_auto()
#把有抵制活動的拉出來變一個新的data
boycott <- subset(DB.csv, q28_5 == 1)
boycott[, 94:100] <- lapply(boycott[, 94:100], as.numeric)

library(FactoMineR)
library(factoextra)
pca_result <- PCA(boycott[, c(94,96,99)], row.w = boycott$weight, scale.unit = TRUE)#選這三個因為好解釋+解釋程度比較高
pc1_loadings <- pca_result$var$coord[, 1]
pc1_loadings

pc1_explained_variance <- pca_result$eig[1, 2]
pc1_explained_variance

#把pc分數加到資料中
pc1_scores <- pca_result$ind$coord[, 1]
boycott$pc1<-pc1_scores



#缺失值轉0
boycott$q28_1[is.na(boycott$q28_1)] <- 0
boycott$q28_2[is.na(boycott$q28_2)] <- 0
boycott$q28_3[is.na(boycott$q28_3)] <- 0
boycott$q28_4[is.na(boycott$q28_4)] <- 0
boycott$q29_1[is.na(boycott$q29_1)] <- 0
boycott$q29_2[is.na(boycott$q29_2)] <- 0
boycott$q29_3[is.na(boycott$q29_3)] <- 0
boycott$q29_4[is.na(boycott$q29_4)] <- 0
boycott$q29_5[is.na(boycott$q29_5)] <- 0
boycott[, 84:93] <- lapply(boycott[, 84:93], as.numeric)
dt<- boycott[, c(84,85,86,89,90,91,92,93)]
#lm
fit1 <- lm(
  pc1~(q28_1+q28_2+q28_3+q29_1+q29_2+q29_3+q29_4+q29_5)^2,
  data = boycott
)
summary(fit1)

#試試把pc分數轉成五個ordinal 分數，做ordinal logistic，結果一樣爛
library(dplyr)
boycott$pcgroup <- ntile(boycott$pc1, 5)
library(VGAM)
model <- vglm(pcgroup~.,family=cumulative(parallel=TRUE),data=data.frame(pcgroup = boycott$pcgroup, dt))
summary(model)

#沒辦法直接算r squared所以算一些其他的r squared
calc_pseudo_r2 <- function(model) {
  # 取得概似函數值
  loglik_model <- logLik(model)[1]
  loglik_null <- logLik(update(model, . ~ 1))[1]
  
  # McFadden's R²
  mcfadden <- 1 - loglik_model/loglik_null
  
  # Nagelkerke's R²
  n <- nobs(model)
  nagelkerke <- (1 - exp((2/n) * (loglik_null - loglik_model))) /
                (1 - exp(2/n * loglik_null))
  
  # Cox & Snell R²
  cox_snell <- 1 - exp(2 * (loglik_null - loglik_model) / n)
  
  # 整理結果
  results <- data.frame(
    Measure = c("McFadden R²", "Nagelkerke R²", "Cox & Snell R²"),
    Value = c(mcfadden, nagelkerke, cox_snell)
  )
  
  return(results)
}

pseudo_r2 <- calc_pseudo_r2(model)
pseudo_r2


#決策樹(我還沒調參)
library(rpart)
library(rpart.plot)
#library(RWeka)
cart.model <- rpart(pc1 ~ ., 
                   data = data.frame(pc1 = boycott$pc1, dt),
                   method = "anova") 
                    
prp(cart.model,         # 模型
    faclen=0,           # 呈現的變數不要縮寫
    fallen.leaves=TRUE, # 讓樹枝以垂直方式呈現
    shadow.col="gray",  # 最下面的節點塗上陰影
    # number of correct classifications / number of observations in that node
    extra=0)  
summary(cart.model)
p.rpart <- predict(cart.model
                   , dt)
plot(p.rpart,boycott$pc1)

```

# 重新定義反應變數(複選題)

因為已經將q28(q28_1~q28_4)跟有沒有抵制行為(q28_5)
因此可以將28題的複選題轉成多類別單選(C4取0~C4取4): 16個類別
C4取4: 1111
C4取3: 1110, 1101, 1011, 0111
C4取2: 1100, 1010, 1001, 0110, 0101, 0011
C4取1: 1000, 0100, 0010, 0001
C4取0: 0000

預期每一種抵制行為模式的背後，有固定的族群輪廓

```{r}
DB.csv$q28_5 <- NULL
DB.csv <- as.data.frame(apply(DB.csv, MARGIN = 2, function(col){
  col <- as.numeric(col)
  col[is.na(col)] <- 0
  return(col)
}))

library(Rtsne)
library(ggpubr)
set.seed(456)
tsne_result <- Rtsne(DB.csv[,-which(colnames(DB.csv)=="weight")], dims = 2)
tsne_df <- as.data.frame(tsne_result$Y)


tsne_df$cluster <- factor(dbscan_result$cluster)
centroids <- tsne_df %>%
  group_by(cluster) %>%
  summarize(V1 = mean(V1), V2 = mean(V2), .groups = 'drop')

ggplot(data = tsne_df)+
  geom_point(aes(x=V1, y=V2, color  = as.factor(cluster)))+
  labs(title = "t-SNE Visualization labelled by DBscan",
       x = "Dimension 1",
       y = "Dimension 2",
       color = "Number") +
  geom_text(data = centroids, aes(x = V1, y = V2, label = cluster), 
            vjust = -1, size = 4, color = "black")+
  theme(legend.position = "right")

ggscatter(data = tsne_df, x = "V1", y = "V2",
          size = 1, color = "cluster", # 使用 cluster 列进行颜色映射
          ellipse = TRUE, 
          ellipse.type = "convex", 
          repel = TRUE, # 防止标签重叠
          title = "t-SNE Visualization labelled by DBscan",
          xlab = "Dimension 1", ylab = "Dimension 2") +
  scale_color_discrete()+
  geom_text(data = centroids, aes(x = V1, y = V2, label = cluster), 
            vjust = -1, size = 4, color = "black")+
  theme(legend.position = "right")
```


```{r}
library(tidyr)
DB.csv <- DB.csv %>%
  mutate_at(vars(starts_with("q8"), starts_with("q10"),starts_with('q11')),~replace_na(., 0))
DB.csv_q28 <- DB.csv[ , !(names(DB.csv) %in% c('q3_other','q6_h','q6_m','q7_h','q7_m','q9_1', 'q9_2', 'q9_3', 'q9_4', 'q9_5', 'q9_6', 'q9_7', 'q9_8', 'q9_88', 'q9_88_text', 'q9_90','q10_88_text', 'q11_88_text', 'q16', 'q17_01', 'q17_02', 'q18', 'q19_01', 'q19_02', 'q20_01_1', 'q20_02_1', 'q22_01_1', 'q22_02_1', 'q22_03_1', 'q22_04_1', 'q22_05_1', 'q23_01_1', 'q23_02_1', 'q23_03_1', 'q23_04_1', 'q23_05_1', 'q24_01_1', 'q24_02_1', 'q24_03_1', 'q24_04_1', 'q24_05_1', 'q25_01_1', 'q25_02_1', 'q25_03_1', 'q25_04_1', 'q26_01_1', 'q26_02_1', 'q26_03_1', 'q28_1', 'q28_2', 'q28_3', 'q28_4', 'q29_1', 'q29_2', 'q29_3', 'q29_4', 'q29_5', 'q30_1', 'q31_1', 'q32_1', 'q33_1', 'q34_1', 'q35_1', 'q36_1'))]
DB.csv_q28$q16_18[is.na(DB.csv_q28$q16_18)] <-5
```
